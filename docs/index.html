<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Obfuscate-OS v3.0</title>
  
  <!-- LOAD EXTERNAL CSS AND JS PROPERLY -->
  <link rel="stylesheet" href="docs/css/animations.css" />
  
  <style>
    :root {
      --primary-purple: #9f70ff;
      --secondary-purple: #d9b3ff;
      --accent-purple: #b98eff;
      --ultra-purple: #7c3aed;
      --soft-purple: #e9d5ff;
      --neon-purple: #a855f7;
      --dark-bg: #0a0a0a;
      --text-primary: #f8fafc;
      --text-secondary: #e2e8f0;
      --text-muted: #cbd5e1;
      --glow-soft: rgba(159, 112, 255, 0.4);
      --glow-bright: rgba(159, 112, 255, 0.6);
      --glow-intense: rgba(159, 112, 255, 0.8);
      --glass-bg: rgba(255, 255, 255, 0.02);
      --glass-border: rgba(255, 255, 255, 0.08);
      --font-mono: 'SF Mono', 'Monaco', 'Cascadia Code', 'Courier New', monospace;
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body { 
      background: 
        radial-gradient(circle at 15% 15%, rgba(159, 112, 255, 0.18) 0%, transparent 45%),
        radial-gradient(circle at 85% 85%, rgba(124, 58, 237, 0.15) 0%, transparent 45%),
        linear-gradient(135deg, #0a0a0a 0%, #1a0a2e 30%, #0f0f23 70%, #1a0a2e 100%);
      min-height: 100vh;
      font-family: var(--font-sans);
      color: var(--text-primary);
      overflow-x: hidden;
    }

    .shell {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2em;
    }

    #terminal-header {
      text-align: center;
      margin: 2em auto 4em;
      padding: 4em 3em 5em;
      max-width: 1400px;
      background: 
        linear-gradient(135deg, var(--glass-bg), rgba(159, 112, 255, 0.06)),
        radial-gradient(circle at 30% 70%, rgba(168, 85, 247, 0.08) 0%, transparent 50%);
      border-radius: 32px;
      backdrop-filter: blur(24px) saturate(200%);
      border: 1px solid var(--glass-border);
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(159, 112, 255, 0.15);
    }

    #terminal-header h1 {
      font-size: clamp(3.5rem, 10vw, 7rem);
      color: var(--text-primary);
      margin-bottom: 0.4em;
      font-weight: 900;
      font-family: var(--font-mono);
      background: linear-gradient(135deg, 
        #ffffff 0%, var(--soft-purple) 15%, var(--secondary-purple) 30%, 
        var(--primary-purple) 50%, var(--neon-purple) 70%, var(--ultra-purple) 85%, 
        var(--accent-purple) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 50px var(--glow-intense));
      position: relative;
    }

    #terminal-header h1::after {
      content: 'v3.0';
      position: absolute;
      top: -0.4em;
      right: 0.5em;
      font-size: 0.35em;
      background: linear-gradient(45deg, var(--neon-purple), #ffffff, var(--primary-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      opacity: 0.85;
      font-weight: 800;
      font-family: system-ui, sans-serif;
    }

    #terminal-header p {
      font-size: 1.5em;
      color: var(--text-secondary);
      opacity: 0.9;
      line-height: 1.6;
      max-width: 55em;
      margin-inline: auto;
    }

    #module-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2.5em;
      justify-items: center;
      width: 100%;
      max-width: 1600px;
      margin: 0 auto;
      padding-bottom: 5em;
    }

    @media (max-width: 1200px) {
      #module-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      #module-grid { 
        grid-template-columns: 1fr;
        gap: 2em;
        padding-bottom: 3em;
      }
      .shell { padding: 0 1em; }
      #terminal-header { padding: 3em 2em; }
    }

    .module-box {
      background: 
        linear-gradient(135deg, var(--glass-bg), rgba(159, 112, 255, 0.07)),
        radial-gradient(circle at 30% 30%, rgba(168, 85, 247, 0.05) 0%, transparent 60%);
      border: 1px solid var(--glass-border);
      padding: 3em 2.5em 3.5em;
      border-radius: 28px;
      text-align: center;
      backdrop-filter: blur(20px) saturate(200%);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      max-width: 420px;
      width: 100%;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .module-box:hover {
      transform: translateY(-12px) scale(1.02);
      border-color: rgba(159, 112, 255, 0.6);
      box-shadow: 
        0 24px 60px rgba(159, 112, 255, 0.3),
        inset 0 2px 0 rgba(255, 255, 255, 0.2);
    }

    .module-box h2 {
      margin: 0 0 1.5em;
      font-size: 1.5rem;
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-weight: 700;
    }

    .module-box p {
      margin-bottom: 2em;
      font-size: 1rem;
      color: var(--text-secondary);
      line-height: 1.7;
      opacity: 0.9;
    }

    .module-box .nav-button {
      padding: 1em 2.5em;
      background: linear-gradient(135deg, rgba(159, 112, 255, 0.1), rgba(217, 179, 255, 0.05));
      border: 1px solid rgba(159, 112, 255, 0.3);
      color: var(--text-primary);
      text-decoration: none;
      display: inline-block;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(8px);
    }

    .module-box:hover .nav-button {
      color: #ffffff;
      border-color: var(--primary-purple);
      transform: translateY(-4px) scale(1.05);
      background: linear-gradient(135deg, var(--ultra-purple), var(--primary-purple), var(--accent-purple));
      box-shadow: 0 12px 32px rgba(159, 112, 255, 0.5);
    }

    .centered-module {
      grid-column: 1 / -1;
      justify-self: center;
      margin: 3em auto;
      max-width: 500px;
      background: 
        linear-gradient(135deg, rgba(159, 112, 255, 0.12), rgba(217, 179, 255, 0.08)),
        radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.08) 0%, transparent 70%);
      border: 2px solid rgba(159, 112, 255, 0.3);
    }

    #site-footer {
      text-align: center;
      font-size: 0.9em;
      color: var(--text-muted);
      border-top: 1px solid rgba(159, 112, 255, 0.2);
      padding: 3em 2em 2em;
      margin-top: 4em;
      background: linear-gradient(135deg, var(--glass-bg), rgba(159, 112, 255, 0.03));
      backdrop-filter: blur(12px);
      border-radius: 24px 24px 0 0;
    }

    #site-footer a {
      color: var(--accent-purple);
      text-decoration: none;
      margin: 0 0.8em;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    #site-footer a:hover {
      color: var(--primary-purple);
      transform: translateY(-2px);
    }

    /* Focus accessibility */
    .module-box:focus-visible {
      outline: 3px solid var(--accent-purple);
      outline-offset: 4px;
    }

    /* Smooth scroll */
    html { scroll-behavior: smooth; }

    /* Selection styling */
    ::selection {
      background: rgba(159, 112, 255, 0.3);
      color: var(--text-primary);
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <header id="terminal-header">
      <h1>Obfuscate-OS</h1>
      <p>A modular guide for encryption, digital resistance, and metadata awareness.</p>
    </header>

    <main id="module-grid">
      <!-- Module cards will be populated by JavaScript -->
    </main>
  </div>

  <footer id="site-footer">
    <p>Â© 2025 Philip Kovacevic â€” Obfuscate-OS Project</p>
    <p>Licensed under <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a></p>
    <p>
      <a href="https://github.com/vikobaldigi" target="_blank">GitHub</a> |
      <a href="mailto:vikobal@protonmail.com">Email</a> |
      <a href="https://www.vikobal.net" target="_blank">Portfolio</a>
    </p>
  </footer>

  <!-- Load animation controller AFTER DOM content -->
  <script src="docs/js/animation-controller.js"></script>
  
  <script>
    const modules = [
      {
        title: "ðŸ§  Learn Encryption",
        desc: "Explore cryptographic concepts and how encryption protects your data.",
        path: "docs/modules/cpu/cpu.html",
        button: "Open CPU"
      },
      {
        title: "ðŸ§¨ Cryptographic Failures", 
        desc: "Murphy's Laws of Encryption â€” common breakdowns and lessons.",
        path: "docs/modules/cpu/sec.html",
        button: "Open SEC"
      },
      {
        title: "ðŸ”‘ Public-Key Cryptography",
        desc: "Understand keypairs, handshakes, and how asymmetric encryption works.",
        path: "docs/modules/crypto/keypair.html",
        button: "Open Keypair"
      },
      {
        title: "ðŸŒ€ Symmetric Ciphers",
        desc: "Discover common encryption algorithms like AES and Caesar cipher.",
        path: "docs/modules/crypto/cypher.html",
        button: "Open Cipher"
      },
      {
        title: "ðŸŒ Metadata Awareness",
        desc: "How surveillance systems exploit metadata and what you can do.",
        path: "docs/modules/net/net.html",
        button: "Open NET"
      },
      {
        title: "ðŸ“– Terminal Basics",
        desc: "Learn how to use CLI to explore, encrypt, and obfuscate.",
        path: "docs/modules/guide/guide.html",
        button: "Open Guide"
      },
      {
        title: "ðŸ”— Blockchain & Cryptocurrency",
        desc: "How decentralization and encryption create public trust without central control.",
        path: "docs/modules/blockchain/blockchain.html",
        button: "Open Blockchain"
      },
      {
        title: "ðŸ”§ Encryption Tools",
        desc: "Discover and practice with real-world software for secure communication.",
        path: "docs/modules/crypto/tools.html",
        button: "Open Tools"
      },
      {
        title: "âš–ï¸ Encryption Ethics",
        desc: "Explore the ethical and political stakes of digital secrecy and obfuscation.",
        path: "docs/modules/crypto/ethics.html",
        button: "Open Ethics"
      },
      {
        title: "ðŸ”¢ Algebra of Cryptography",
        desc: "How groups, fields, and lattices secure digital communication.",
        path: "docs/modules/algebra/algebra.html",
        button: "Open Algebra"
      },
      {
        title: "ðŸ“š Further Reading",
        desc: "Foundational texts in cryptography, obfuscation, and digital resistance.",
        path: "docs/modules/further/further.html",
        button: "Open BOOKS"
      },
      {
        title: "ðŸ§ª Cryptographic Exercises",
        desc: "A full suite of interactive tools to learn and experiment with encryption.",
        path: "docs/modules/exercises/index.html",
        button: "Open Exercises"
      },
      {
        title: "ðŸ“– Glossary of Terms",
        desc: "A reference list of key encryption and command-line concepts covered throughout Obfuscate-OS.",
        path: "docs/modules/glossary/glossary.html",
        button: "Open Glossary",
        center: true
      }
    ];

    // Wait for animation controller to be ready, but don't block rendering
    let animationControllerReady = false;
    
    // Initialize modules immediately
    function initializeModules() {
      console.log('[obfuscate-os-v3] Initializing modules...');
      
      const grid = document.getElementById("module-grid");
      if (!grid) {
        console.error('[obfuscate-os-v3] Module grid not found');
        return;
      }

      modules.forEach((mod, index) => {
        const card = document.createElement("div");
        card.className = "module-box";
        
        if (mod.center) {
          card.classList.add("centered-module");
        }

        card.innerHTML = `
          <h2>${mod.title}</h2>
          <p>${mod.desc}</p>
          <a href="${mod.path}" class="nav-button">${mod.button}</a>
        `;

        // Enhanced interactions with animation controller when available
        card.addEventListener('mousemove', function(e) {
          if (window.animationController && animationControllerReady) {
            window.animationController.updateMousePosition(this, e);
          }
        });

        card.addEventListener('mouseleave', function() {
          if (window.animationController && animationControllerReady) {
            window.animationController.clearMousePosition(this);
          }
        });

        card.addEventListener('click', function(e) {
          if (!e.target.closest('.nav-button')) {
            const button = this.querySelector('.nav-button');
            if (button) {
              if (window.animationController && animationControllerReady) {
                window.animationController.animateClick(this);
              }
              setTimeout(() => button.click(), 150);
            }
          }
        });

        // Accessibility
        card.setAttribute('tabindex', '0');
        card.setAttribute('role', 'button');
        card.setAttribute('aria-label', `${mod.title} - ${mod.desc}`);
        
        card.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            const button = this.querySelector('.nav-button');
            if (button) {
              if (window.animationController && animationControllerReady) {
                window.animationController.animateClick(button);
              }
              setTimeout(() => button.click(), 150);
            }
          }
        });

        grid.appendChild(card);
      });

      // Global utilities
      window.ObfuscateOS = {
        version: '3.0',
        modules: modules,
        animationController: window.animationController,
        scrollToTop: () => {
          if (window.animationController && animationControllerReady) {
            window.animationController.animatedScrollToTop();
          } else {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        }
      };

      console.log(`[obfuscate-os-v3] âœ¨ ${modules.length} modules initialized successfully`);
    }

    // Initialize immediately when DOM is ready
    document.addEventListener("DOMContentLoaded", () => {
      initializeModules();
      
      // Check for animation controller periodically
      const checkAnimationController = () => {
        if (window.animationController && !animationControllerReady) {
          animationControllerReady = true;
          console.log('[obfuscate-os-v3] Animation controller connected');
          
          // Apply any waiting animations
          window.dispatchEvent(new CustomEvent('animation-controller-ready'));
        }
      };
      
      // Check immediately and then periodically
      checkAnimationController();
      const interval = setInterval(() => {
        checkAnimationController();
        if (animationControllerReady) {
          clearInterval(interval);
        }
      }, 100);
      
      // Stop checking after 5 seconds
      setTimeout(() => {
        clearInterval(interval);
        if (!animationControllerReady) {
          console.warn('[obfuscate-os-v3] Animation controller not found, continuing without advanced animations');
        }
      }, 5000);
    });

    // Performance monitoring
    window.addEventListener('load', () => {
      if ('performance' in window) {
        const loadTime = performance.now();
        console.log(`[obfuscate-os-v3] Page loaded in ${loadTime.toFixed(2)}ms`);
        
        // Check if all resources loaded successfully
        const navigation = performance.getEntriesByType('navigation')[0];
        if (navigation) {
          console.log(`[obfuscate-os-v3] Total load time: ${(navigation.loadEventEnd - navigation.fetchStart).toFixed(2)}ms`);
        }
      }
    });

    // Enhanced keyboard shortcuts
    document.addEventListener('keydown', (event) => {
      // Escape to scroll to top
      if (event.key === 'Escape') {
        event.preventDefault();
        window.ObfuscateOS.scrollToTop();
      }
      
      // Number keys for direct module access
      if (event.key >= '1' && event.key <= '9') {
        const moduleIndex = parseInt(event.key) - 1;
        const moduleCards = document.querySelectorAll('.module-box');
        if (moduleCards[moduleIndex]) {
          event.preventDefault();
          moduleCards[moduleIndex].focus();
          
          // Double-tap to activate
          if (event.repeat) {
            moduleCards[moduleIndex].querySelector('.nav-button').click();
          }
        }
      }
    });

    // Error handling
    window.addEventListener('error', (event) => {
      console.error('[obfuscate-os-v3] Error:', event.error?.message || event.message);
    });
  </script>
</body>
</html>