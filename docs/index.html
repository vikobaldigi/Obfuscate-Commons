<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Obfuscate-OS v3.0</title>
  
  <!-- INTEGRATED: External animation CSS -->
  <link rel="stylesheet" href="css/animations.css" />
  
  <style>
    :root {
      /* Enhanced Color Palette */
      --primary-purple: #9f70ff;
      --secondary-purple: #d9b3ff;
      --accent-purple: #b98eff;
      --ultra-purple: #7c3aed;
      --soft-purple: #e9d5ff;
      --neon-purple: #a855f7;
      --dark-bg: #0a0a0a;
      --card-bg: rgba(159, 112, 255, 0.08);
      --border-subtle: rgba(159, 112, 255, 0.25);
      --text-primary: #f8fafc;
      --text-secondary: #e2e8f0;
      --text-muted: #cbd5e1;
      --glow-soft: rgba(159, 112, 255, 0.4);
      --glow-bright: rgba(159, 112, 255, 0.6);
      --glow-intense: rgba(159, 112, 255, 0.8);
      --glass-bg: rgba(255, 255, 255, 0.02);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-hover: rgba(255, 255, 255, 0.05);
      
      /* Typography */
      --font-mono: 'SF Mono', 'Monaco', 'Cascadia Code', 'Courier New', monospace;
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body { 
      background: 
        radial-gradient(circle at 15% 15%, rgba(159, 112, 255, 0.18) 0%, transparent 45%),
        radial-gradient(circle at 85% 85%, rgba(124, 58, 237, 0.15) 0%, transparent 45%),
        radial-gradient(circle at 50% 30%, rgba(217, 179, 255, 0.08) 0%, transparent 40%),
        radial-gradient(circle at 30% 70%, rgba(168, 85, 247, 0.12) 0%, transparent 35%),
        linear-gradient(135deg, #0a0a0a 0%, #1a0a2e 30%, #0f0f23 70%, #1a0a2e 100%);
      min-height: 100vh;
      font-family: var(--font-sans);
      color: var(--text-primary);
      overflow-x: hidden;
      position: relative;
    }

    /* Enhanced floating particles with better timing */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(159, 112, 255, 0.03) 1px, transparent 1px),
        radial-gradient(circle at 80% 70%, rgba(217, 179, 255, 0.025) 1px, transparent 1px),
        radial-gradient(circle at 45% 20%, rgba(124, 58, 237, 0.02) 1px, transparent 1px);
      background-size: 60px 60px, 90px 90px, 120px 120px;
      animation: float-particles 30s ease-in-out infinite;
      pointer-events: none;
      z-index: -1;
      opacity: 0;
      transition: opacity 2s ease;
    }

    body.loaded::before {
      opacity: 1;
    }

    /* Container */
    .shell {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2em;
      position: relative;
    }

    /* Ultra-Modern Hero Header */
    #terminal-header {
      text-align: center;
      margin: 2em auto 4em;
      padding: 4em 3em 5em;
      max-width: 1400px;
      background: 
        linear-gradient(135deg, var(--glass-bg), rgba(159, 112, 255, 0.06)),
        linear-gradient(225deg, transparent, rgba(255, 255, 255, 0.02)),
        radial-gradient(circle at 30% 70%, rgba(168, 85, 247, 0.08) 0%, transparent 50%);
      border-radius: 32px;
      backdrop-filter: blur(24px) saturate(200%);
      border: 1px solid var(--glass-border);
      position: relative;
      overflow: visible;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(159, 112, 255, 0.15);
    }

    #terminal-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, 
        transparent, 
        var(--ultra-purple), 
        var(--primary-purple), 
        var(--neon-purple),
        var(--accent-purple), 
        var(--secondary-purple), 
        transparent);
      animation: shimmer-header 6s ease-in-out infinite;
    }

    #terminal-header::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), 
        rgba(159, 112, 255, 0.06) 0%, 
        transparent 60%);
      opacity: 0;
      transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
    }

    #terminal-header:hover::after {
      opacity: 1;
    }

    @keyframes shimmer-header {
      0%, 100% { 
        opacity: 0.3; 
        transform: scaleX(1);
      }
      50% { 
        opacity: 1; 
        transform: scaleX(1.02);
      }
    }

    #terminal-header h1 {
      font-size: clamp(3.5rem, 10vw, 7rem);
      color: var(--text-primary);
      margin-bottom: 0.4em;
      font-weight: 900;
      letter-spacing: -0.02em;
      font-family: var(--font-mono);
      background: linear-gradient(135deg, 
        #ffffff 0%,
        var(--soft-purple) 15%, 
        var(--secondary-purple) 30%, 
        var(--primary-purple) 50%, 
        var(--neon-purple) 70%,
        var(--ultra-purple) 85%, 
        var(--accent-purple) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 50px var(--glow-intense)) drop-shadow(0 0 100px rgba(159, 112, 255, 0.3));
      animation: mega-pulse-glow 10s ease-in-out infinite;
      position: relative;
      overflow: visible;
      display: block;
      width: 100%;
      text-align: center;
      text-shadow: 0 0 60px rgba(159, 112, 255, 0.5);
      line-height: 0.9;
      margin-left: auto;
      margin-right: auto;
    }

    #terminal-header h1::after {
      content: 'v3.0';
      position: absolute;
      top: -0.4em;
      right: 0.5em;
      font-size: 0.35em;
      background: linear-gradient(45deg, 
        var(--neon-purple), 
        #ffffff, 
        var(--primary-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      opacity: 0.85;
      font-weight: 800;
      white-space: nowrap;
      z-index: 10;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      letter-spacing: 0.08em;
      filter: drop-shadow(0 0 20px rgba(159, 112, 255, 0.6));
      animation: version-pulse 10s ease-in-out infinite;
    }

    #terminal-header p {
      font-size: 1.5em;
      color: var(--text-secondary);
      margin: 0;
      opacity: 0.9;
      font-weight: 400;
      line-height: 1.6;
      max-width: 55em;
      margin-inline: auto;
      text-shadow: 0 2px 12px rgba(0, 0, 0, 0.4);
      letter-spacing: 0.01em;
      font-family: var(--font-sans);
    }

    /* Ultra-Modern Module Grid */
    #module-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2.5em;
      justify-items: center;
      width: 100%;
      max-width: 1600px;
      margin: 0 auto;
      padding-bottom: 5em;
    }

    @media (max-width: 1200px) {
      #module-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      #module-grid {
        grid-template-columns: 1fr;
        gap: 2em;
        padding-bottom: 3em;
      }
    }

    /* Ultra-Glossy Module Cards */
    .module-box {
      background: 
        linear-gradient(135deg, 
          var(--glass-bg), 
          rgba(159, 112, 255, 0.07)),
        linear-gradient(225deg, 
          transparent, 
          rgba(255, 255, 255, 0.03)),
        radial-gradient(circle at 30% 30%, 
          rgba(168, 85, 247, 0.05) 0%, 
          transparent 60%);
      border: 1px solid var(--glass-border);
      padding: 3em 2.5em 3.5em;
      border-radius: 28px;
      text-align: center;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(20px) saturate(200%);
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(159, 112, 255, 0.1);
      max-width: 420px;
      width: 100%;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transform-style: preserve-3d;
    }

    .module-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        var(--accent-purple), 
        var(--primary-purple), 
        var(--neon-purple),
        var(--accent-purple), 
        transparent);
      opacity: 0;
      transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), transform 0.6s ease;
      transform: scaleX(0);
    }

    .module-box::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), 
        rgba(159, 112, 255, 0.08) 0%, 
        transparent 65%);
      opacity: 0;
      transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: none;
    }

    .module-box:hover {
      transform: translateY(-16px) scale(1.02) rotateX(3deg) rotateY(-1deg);
      border-color: rgba(159, 112, 255, 0.6);
      box-shadow: 
        0 30px 80px rgba(159, 112, 255, 0.3),
        inset 0 2px 0 rgba(255, 255, 255, 0.2),
        0 0 0 1px rgba(159, 112, 255, 0.5),
        0 0 80px rgba(159, 112, 255, 0.2);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .module-box:hover::before {
      opacity: 1;
      transform: scaleX(1);
    }

    .module-box:hover::after {
      opacity: 1;
    }

    .module-box:active {
      transform: translateY(-12px) scale(1.01) rotateX(2deg);
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.6, 1);
    }

    .module-box h2 {
      margin: 0 0 1.5em;
      font-size: 1.5rem;
      color: var(--text-primary);
      font-family: var(--font-mono);
      line-height: 1.3;
      font-weight: 700;
      letter-spacing: -0.01em;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .module-box h2::after {
      content: '';
      position: absolute;
      bottom: -0.5em;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, 
        var(--accent-purple), 
        var(--primary-purple));
      border-radius: 1px;
      opacity: 0;
      transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), width 0.4s ease;
    }

    .module-box:hover h2::after {
      opacity: 1;
      width: 80px;
    }

    .module-box p {
      margin-top: 0;
      margin-bottom: 2em;
      font-size: 1rem;
      color: var(--text-secondary);
      line-height: 1.7;
      font-weight: 400;
      opacity: 0.9;
    }

    .module-box .nav-button {
      margin-top: 1.5em;
      padding: 1em 2.5em;
      background: 
        linear-gradient(135deg, 
          rgba(159, 112, 255, 0.1), 
          rgba(217, 179, 255, 0.05)),
        linear-gradient(225deg, 
          transparent, 
          rgba(255, 255, 255, 0.02));
      border: 1px solid rgba(159, 112, 255, 0.3);
      color: var(--text-primary);
      font-family: inherit;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 16px;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(8px);
      box-shadow: 
        0 4px 16px rgba(159, 112, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      letter-spacing: -0.01em;
    }

    .module-box .nav-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, 
        var(--ultra-purple), 
        var(--primary-purple), 
        var(--neon-purple),
        var(--accent-purple));
      opacity: 0;
      transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: -1;
    }

    .module-box .nav-button::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.15), 
        transparent);
      transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .module-box:hover .nav-button {
      color: #ffffff;
      border-color: var(--primary-purple);
      transform: translateY(-4px) scale(1.05);
      box-shadow: 
        0 12px 32px rgba(159, 112, 255, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }

    .module-box:hover .nav-button::before {
      opacity: 0.9;
    }

    .module-box:hover .nav-button::after {
      left: 100%;
    }

    /* Special styling for centered modules */
    .centered-module {
      grid-column: 1 / -1;
      justify-self: center;
      margin: 3em auto;
      max-width: 500px;
      background: 
        linear-gradient(135deg, 
          rgba(159, 112, 255, 0.12), 
          rgba(217, 179, 255, 0.08)),
        radial-gradient(circle at 50% 50%, 
          rgba(168, 85, 247, 0.08) 0%, 
          transparent 70%);
      border: 2px solid rgba(159, 112, 255, 0.3);
    }

    .centered-module:hover {
      box-shadow: 
        0 35px 90px rgba(159, 112, 255, 0.35),
        inset 0 2px 0 rgba(255, 255, 255, 0.25),
        0 0 0 2px rgba(159, 112, 255, 0.6),
        0 0 100px rgba(159, 112, 255, 0.25);
    }

    /* Enhanced Footer */
    #site-footer {
      text-align: center;
      font-size: 0.9em;
      color: var(--text-muted);
      border-top: 1px solid rgba(159, 112, 255, 0.2);
      padding: 3em 2em 2em;
      margin-top: 4em;
      width: 100%;
      background: 
        linear-gradient(135deg, var(--glass-bg), rgba(159, 112, 255, 0.03)),
        linear-gradient(225deg, transparent, rgba(255, 255, 255, 0.01));
      backdrop-filter: blur(12px);
      border-radius: 24px 24px 0 0;
    }

    #site-footer a {
      color: var(--accent-purple);
      text-decoration: none;
      margin: 0 0.8em;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      position: relative;
    }

    #site-footer a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background: var(--primary-purple);
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #site-footer a:hover {
      color: var(--primary-purple);
      text-shadow: 0 0 12px var(--glow-soft);
      transform: translateY(-1px);
    }

    #site-footer a:hover::after {
      width: 100%;
    }

    /* Scroll progress bar */
    #scroll-progress {
      position: fixed;
      top: 0;
      left: 0;
      width: 0%;
      height: 4px;
      background: linear-gradient(90deg, 
        var(--ultra-purple), 
        var(--primary-purple), 
        var(--accent-purple), 
        var(--secondary-purple));
      z-index: 9999;
      transition: width 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 0 16px var(--glow-bright),
        0 4px 8px rgba(159, 112, 255, 0.3);
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      body {
        padding: 1em 0.5em;
      }

      .shell {
        padding: 0 1em;
      }

      #terminal-header {
        margin-bottom: 3em;
        padding: 3em 2em;
      }

      #terminal-header h1 {
        font-size: clamp(2.5rem, 12vw, 4rem);
      }

      #terminal-header p {
        font-size: 1.2em;
      }

      #module-grid {
        grid-template-columns: 1fr;
        gap: 2em;
        padding-bottom: 3em;
      }

      .module-box {
        padding: 2.5em 2em;
        max-width: 100%;
      }

      .module-box h2 {
        font-size: 1.3rem;
      }

      .module-box .nav-button {
        padding: 1em 2em;
        font-size: 1rem;
      }

      #site-footer {
        padding: 2em 1em;
      }
    }

    /* Accessibility - Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.15ms !important;
      }
      
      .module-box,
      #terminal-header,
      .shell,
      #module-grid,
      #site-footer {
        transform: none !important;
        opacity: 1 !important;
      }
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --text-primary: #ffffff;
        --text-secondary: #e0e0e0;
        --primary-purple: #bb88ff;
        --accent-purple: #cc99ff;
        --border-subtle: rgba(255, 255, 255, 0.4);
      }
    }

    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    /* Selection styling */
    ::selection {
      background: rgba(159, 112, 255, 0.3);
      color: var(--text-primary);
    }

    ::-moz-selection {
      background: rgba(159, 112, 255, 0.3);
      color: var(--text-primary);
    }

    /* Focus indicators */
    .module-box:focus-visible {
      outline: 3px solid var(--accent-purple);
      outline-offset: 4px;
    }

    .nav-button:focus-visible {
      outline: 2px solid var(--accent-purple);
      outline-offset: 2px;
    }

    /* Performance optimizations */
    .module-box,
    #terminal-header,
    .shell {
      will-change: transform, opacity;
      backface-visibility: hidden;
    }

    .module-box:hover {
      will-change: transform, box-shadow;
    }

    /* Loading spinner for initial load */
    .loading-spinner {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      border: 3px solid rgba(159, 112, 255, 0.3);
      border-top: 3px solid var(--primary-purple);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    .loading-spinner.hidden {
      opacity: 0;
      pointer-events: none;
    }

    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Loading spinner -->
  <div class="loading-spinner" id="loading-spinner"></div>
  
  <div id="scroll-progress"></div>
  
  <div class="shell">
    <header id="terminal-header">
      <h1>Obfuscate-OS</h1>
      <p>A modular guide for encryption, digital resistance, and metadata awareness.</p>
    </header>

    <main id="module-grid">
      <!-- Module cards will be populated by JavaScript -->
    </main>
  </div>

  <footer id="site-footer">
    <p>© 2025 Philip Kovacevic — Obfuscate-OS Project</p>
    <p>Licensed under <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a></p>
    <p>
      <a href="https://github.com/vikobaldigi" target="_blank">GitHub</a> |
      <a href="mailto:vikobal@protonmail.com">Email</a> |
      <a href="https://www.vikobal.net" target="_blank">Portfolio</a>
    </p>
  </footer>

  <!-- INTEGRATED: External animation controller -->
  <script src="js/animation-controller.js"></script>
  
  <script>
    // CORRECTED MODULE DATA WITH PROPER PATHS
    const modules = [
      {
        title: "🧠 Learn Encryption",
        desc: "Explore cryptographic concepts and how encryption protects your data.",
        path: "modules/cpu/cpu.html",
        button: "Open CPU"
      },
      {
        title: "🧨 Cryptographic Failures", 
        desc: "Murphy's Laws of Encryption — common breakdowns and lessons.",
        path: "modules/cpu/sec.html",
        button: "Open SEC"
      },
      {
        title: "🔑 Public-Key Cryptography",
        desc: "Understand keypairs, handshakes, and how asymmetric encryption works.",
        path: "modules/crypto/keypair.html",
        button: "Open Keypair"
      },
      {
        title: "🌀 Symmetric Ciphers",
        desc: "Discover common encryption algorithms like AES and Caesar cipher.",
        path: "modules/crypto/cypher.html",
        button: "Open Cipher"
      },
      {
        title: "🌐 Metadata Awareness",
        desc: "How surveillance systems exploit metadata and what you can do.",
        path: "modules/net/net.html",
        button: "Open NET"
      },
      {
        title: "📖 Terminal Basics",
        desc: "Learn how to use CLI to explore, encrypt, and obfuscate.",
        path: "modules/guide/guide.html",
        button: "Open Guide"
      },
      {
        title: "🔗 Blockchain & Cryptocurrency",
        desc: "How decentralization and encryption create public trust without central control.",
        path: "modules/blockchain/blockchain.html",
        button: "Open Blockchain"
      },
      {
        title: "🔧 Encryption Tools",
        desc: "Discover and practice with real-world software for secure communication.",
        path: "modules/crypto/tools.html",
        button: "Open Tools"
      },
      {
        title: "⚖️ Encryption Ethics",
        desc: "Explore the ethical and political stakes of digital secrecy and obfuscation.",
        path: "modules/crypto/ethics.html",
        button: "Open Ethics"
      },
      {
        title: "🔢 Algebra of Cryptography",
        desc: "How groups, fields, and lattices secure digital communication.",
        path: "modules/algebra/algebra.html",
        button: "Open Algebra"
      },
      {
        title: "📚 Further Reading",
        desc: "Foundational texts in cryptography, obfuscation, and digital resistance.",
        path: "modules/further/further.html",
        button: "Open BOOKS"
      },
      {
        title: "🧪 Cryptographic Exercises",
        desc: "A full suite of interactive tools to learn and experiment with encryption.",
        path: "modules/exercises/index.html",
        button: "Open Exercises"
      },
      {
        title: "📖 Glossary of Terms",
        desc: "A reference list of key encryption and command-line concepts covered throughout Obfuscate-OS.",
        path: "modules/glossary/glossary.html",
        button: "Open Glossary",
        center: true
      }
    ];

    // STREAMLINED: Main initialization with external animation controller integration
    document.addEventListener("DOMContentLoaded", () => {
      console.log('[obfuscate-os-v3] Streamlined homepage initializing...');
      
      // Wait for external animation controller to load
      const waitForAnimationController = () => {
        if (window.animationController) {
          initializeModules();
        } else {
          setTimeout(waitForAnimationController, 50);
        }
      };
      
      const initializeModules = () => {
        const grid = document.getElementById("module-grid");
        if (!grid) return;

        // Create modules with streamlined interactions
        modules.forEach((mod, index) => {
          const card = document.createElement("div");
          card.className = "module-box";
          
          if (mod.center) {
            card.classList.add("centered-module");
          }

          card.innerHTML = `
            <h2>${mod.title}</h2>
            <p>${mod.desc}</p>
            <a href="${mod.path}" class="nav-button">${mod.button}</a>
          `;

          // STREAMLINED: Use external animation controller for interactions
          if (window.animationController) {
            // Mouse tracking
            card.addEventListener('mousemove', function(e) {
              window.animationController.updateMousePosition(this, e);
            });

            card.addEventListener('mouseleave', function() {
              window.animationController.clearMousePosition(this);
            });

            // Click handling with animation
            card.addEventListener('click', function(e) {
              if (!e.target.closest('.nav-button')) {
                const button = this.querySelector('.nav-button');
                if (button) {
                  window.animationController.animateClick(this);
                  setTimeout(() => button.click(), 150);
                }
              }
            });
          }

          // Accessibility
          card.setAttribute('tabindex', '0');
          card.setAttribute('role', 'button');
          card.setAttribute('aria-label', `${mod.title} - ${mod.desc}`);
          
          card.addEventListener('focus', function() {
            this.style.outline = '3px solid var(--accent-purple)';
            this.style.outlineOffset = '4px';
          });
          
          card.addEventListener('blur', function() {
            this.style.outline = '';
            this.style.outlineOffset = '';
          });
          
          card.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              const button = this.querySelector('.nav-button');
              if (button) {
                if (window.animationController) {
                  window.animationController.animateClick(button);
                }
                setTimeout(() => button.click(), 150);
              }
            }
          });

          grid.appendChild(card);
        });

        // Export utilities for debugging and extension
        window.ObfuscateOS = window.ObfuscateOS || {};
        Object.assign(window.ObfuscateOS, {
          version: '3.0',
          page: 'index',
          modules: modules,
          animationController: window.animationController,
          scrollToTop: () => {
            if (window.animationController) {
              window.animationController.animatedScrollToTop();
            } else {
              window.scrollTo({ top: 0, behavior: 'smooth' });
            }
          },
          focusFirstModule: () => {
            const firstModule = document.querySelector('.module-box');
            if (firstModule) {
              firstModule.focus();
              if (window.animationController) {
                window.animationController.highlightElement(firstModule);
              }
            }
          },
          getModuleCount: () => document.querySelectorAll('.module-box').length,
          enableDebugMode: () => {
            document.body.classList.add('debug-mode');
            console.log('[obfuscate-os-v3] Debug mode enabled');
            
            const debugStyle = document.createElement('style');
            debugStyle.textContent = `
              .debug-mode .module-box {
                border: 2px dashed rgba(255, 100, 100, 0.5) !important;
                position: relative;
              }
              .debug-mode .module-box::after {
                content: attr(aria-label);
                position: absolute;
                top: -3em;
                left: 0;
                font-size: 0.7em;
                color: #ff6b6b;
                background: rgba(0, 0, 0, 0.9);
                padding: 0.3em 0.6em;
                border-radius: 6px;
                z-index: 1000;
                max-width: 250px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
              }
              .debug-mode #terminal-header {
                border: 2px dashed rgba(100, 255, 100, 0.5) !important;
              }
              .debug-mode .shell {
                border: 2px dashed rgba(100, 100, 255, 0.5) !important;
              }
            `;
            document.head.appendChild(debugStyle);
          },
          getPerformanceMetrics: () => {
            if ('performance' in window) {
              return {
                navigation: performance.getEntriesByType('navigation')[0],
                resources: performance.getEntriesByType('resource'),
                measures: performance.getEntriesByType('measure'),
                animationMode: window.animationController?.performanceMode || 'unknown',
                reducedMotion: window.animationController?.reducedMotion || false
              };
            }
            return null;
          },
          togglePerformanceMode: () => {
            if (window.animationController) {
              window.animationController.performanceMode = 
                window.animationController.performanceMode === 'high' ? 'low' : 'high';
              if (window.animationController.performanceMode === 'low') {
                window.animationController.optimizeForLowPerformance();
              }
              console.log(`[obfuscate-os-v3] Performance mode: ${window.animationController.performanceMode}`);
            }
          },
          createTestRipple: (x = 400, y = 300) => {
            if (window.animationController) {
              window.animationController.createTestRipple(x, y);
            }
          }
        });

        // STREAMLINED: Enhanced context menu
        document.addEventListener('contextmenu', function(e) {
          if (e.target.closest('.module-box')) {
            e.preventDefault();
            
            const moduleBox = e.target.closest('.module-box');
            const moduleTitle = moduleBox.querySelector('h2').textContent;
            const modulePath = moduleBox.querySelector('.nav-button').href;
            
            const contextMenu = document.createElement('div');
            contextMenu.style.cssText = `
              position: fixed;
              left: ${e.clientX}px;
              top: ${e.clientY}px;
              background: linear-gradient(135deg, var(--glass-bg), rgba(159, 112, 255, 0.1));
              border: 1px solid var(--glass-border);
              border-radius: 12px;
              padding: 0.8em;
              backdrop-filter: blur(20px);
              z-index: 10000;
              font-size: 0.9em;
              box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
              min-width: 200px;
              animation: contextMenuAppear 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            `;
            
            if (!document.querySelector('#context-menu-styles')) {
              const style = document.createElement('style');
              style.id = 'context-menu-styles';
              style.textContent = `
                @keyframes contextMenuAppear {
                  from {
                    opacity: 0;
                    transform: scale(0.9) translateY(-10px);
                  }
                  to {
                    opacity: 1;
                    transform: scale(1) translateY(0);
                  }
                }
                .context-menu-item {
                  padding: 0.7em 1em;
                  color: var(--text-primary);
                  cursor: pointer;
                  border-radius: 8px;
                  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                  display: flex;
                  align-items: center;
                  gap: 0.8em;
                }
                .context-menu-item:hover {
                  background: rgba(159, 112, 255, 0.2);
                  transform: translateX(4px);
                }
              `;
              document.head.appendChild(style);
            }
            
            contextMenu.innerHTML = `
              <div class="context-menu-item" data-action="copy-title">
                📋 Copy Module Name
              </div>
              <div class="context-menu-item" data-action="open-new-tab">
                🔗 Open in New Tab
              </div>
              <div class="context-menu-item" data-action="copy-link">
                🌐 Copy Module Link
              </div>
              <div class="context-menu-item" data-action="focus-module">
                🎯 Focus Module
              </div>
            `;
            
            contextMenu.addEventListener('click', function(event) {
              const action = event.target.getAttribute('data-action');
              
              switch(action) {
                case 'copy-title':
                  navigator.clipboard.writeText(moduleTitle).then(() => {
                    console.log('Module title copied:', moduleTitle);
                  });
                  break;
                case 'open-new-tab':
                  window.open(modulePath, '_blank');
                  break;
                case 'copy-link':
                  navigator.clipboard.writeText(window.location.origin + '/' + moduleBox.querySelector('.nav-button').getAttribute('href')).then(() => {
                    console.log('Module link copied');
                  });
                  break;
                case 'focus-module':
                  moduleBox.focus();
                  if (window.animationController) {
                    window.animationController.highlightElement(moduleBox);
                  }
                  break;
              }
              
              this.remove();
            });
            
            document.body.appendChild(contextMenu);
            
            setTimeout(() => {
              document.addEventListener('click', function removeMenu(e) {
                if (!contextMenu.contains(e.target)) {
                  contextMenu.remove();
                  document.removeEventListener('click', removeMenu);
                }
              });
            }, 100);
          }
        });

        // STREAMLINED: Enhanced keyboard shortcuts
        document.addEventListener('keydown', function(event) {
          // Alt + D for debug mode
          if (event.altKey && event.key === 'd') {
            event.preventDefault();
            window.ObfuscateOS.enableDebugMode();
          }
          
          // Alt + P for performance toggle
          if (event.altKey && event.key === 'p') {
            event.preventDefault();
            window.ObfuscateOS.togglePerformanceMode();
          }
          
          // Alt + R for test ripple
          if (event.altKey && event.key === 'r') {
            event.preventDefault();
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            window.ObfuscateOS.createTestRipple(x, y);
          }
          
          // Number keys 1-9 for direct module access
          if (event.key >= '1' && event.key <= '9') {
            const moduleIndex = parseInt(event.key) - 1;
            const modules = document.querySelectorAll('.module-box');
            if (modules[moduleIndex]) {
              event.preventDefault();
              modules[moduleIndex].focus();
              if (window.animationController) {
                window.animationController.highlightElement(modules[moduleIndex]);
              }
              
              // Double-tap to activate
              if (event.repeat) {
                modules[moduleIndex].querySelector('.nav-button').click();
              }
            }
          }
        });

        // STREAMLINED: Konami code with enhanced effects
        let konamiCode = [];
        const konamiSequence = [
          'ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown',
          'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight',
          'KeyB', 'KeyA'
        ];

        document.addEventListener('keydown', function(e) {
          konamiCode.push(e.code);
          if (konamiCode.length > konamiSequence.length) {
            konamiCode.shift();
          }
          
          if (konamiCode.join(',') === konamiSequence.join(',')) {
            document.body.style.filter = 'hue-rotate(0deg) saturate(2) brightness(1.2)';
            document.body.style.animation = 'rainbow-mode 3s ease-in-out';
            
            const rainbowStyle = document.createElement('style');
            rainbowStyle.textContent = `
              @keyframes rainbow-mode {
                0% { filter: hue-rotate(0deg) saturate(2) brightness(1.2); }
                25% { filter: hue-rotate(90deg) saturate(2.5) brightness(1.3); }
                50% { filter: hue-rotate(180deg) saturate(3) brightness(1.4); }
                75% { filter: hue-rotate(270deg) saturate(2.5) brightness(1.3); }
                100% { filter: hue-rotate(360deg) saturate(2) brightness(1.2); }
              }
            `;
            document.head.appendChild(rainbowStyle);
            
            // Create celebratory particles
            if (window.animationController) {
              for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                  window.animationController.createFloatingParticle(
                    document.getElementById('advanced-particles') || document.body
                  );
                }, i * 100);
              }
            }
            
            setTimeout(() => {
              document.body.style.filter = '';
              document.body.style.animation = '';
              rainbowStyle.remove();
            }, 3000);
            
            console.log('🎉 KONAMI CODE ACTIVATED! Ultra-rainbow mode engaged! 🌈');
            konamiCode = [];
          }
        });

        // Auto-save and restore state
        window.addEventListener('beforeunload', function() {
          const state = {
            scrollPosition: window.pageYOffset,
            timestamp: Date.now(),
            performanceMode: window.animationController?.performanceMode || 'high'
          };
          sessionStorage.setItem('obfuscate-os-state', JSON.stringify(state));
        });

        window.addEventListener('load', function() {
          const savedState = sessionStorage.getItem('obfuscate-os-state');
          if (savedState) {
            try {
              const state = JSON.parse(savedState);
              
              if (Date.now() - state.timestamp < 300000) {
                window.scrollTo(0, state.scrollPosition);
              }
              
              if (state.performanceMode && window.animationController) {
                window.animationController.performanceMode = state.performanceMode;
              }
              
              sessionStorage.removeItem('obfuscate-os-state');
            } catch (error) {
              console.warn('[obfuscate-os-v3] Failed to restore state:', error);
            }
          }
        });

        // Performance and error monitoring
        if ('performance' in window) {
          window.addEventListener('load', function() {
            setTimeout(() => {
              const perfData = performance.getEntriesByType('navigation')[0];
              if (perfData) {
                const loadTime = perfData.loadEventEnd - perfData.loadEventStart;
                const totalTime = perfData.loadEventEnd - perfData.fetchStart;
                console.log(`[obfuscate-os-v3] Load sequence completed in ${loadTime.toFixed(2)}ms`);
                console.log(`[obfuscate-os-v3] Total page load time: ${totalTime.toFixed(2)}ms`);
                
                if (totalTime > 3000) {
                  console.warn('[obfuscate-os-v3] Slow load detected, consider optimization');
                }
              }
            }, 0);
          });
        }

        // Error handling
        window.addEventListener('error', function(event) {
          console.error('[obfuscate-os-v3] JavaScript error:', event.error?.message || event.message);
        });

        window.addEventListener('unhandledrejection', function(event) {
          console.warn('[obfuscate-os-v3] Unhandled promise rejection:', event.reason);
        });

        // Accessibility announcements
        function announceToScreenReader(message) {
          const announcement = document.createElement('div');
          announcement.setAttribute('aria-live', 'polite');
          announcement.setAttribute('aria-atomic', 'true');
          announcement.style.cssText = `
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
          `;
          announcement.textContent = message;
          document.body.appendChild(announcement);
          
          setTimeout(() => announcement.remove(), 1000);
        }

        setTimeout(() => {
          announceToScreenReader('Obfuscate-OS homepage loaded. Navigate with arrow keys or tab through modules.');
        }, 2000);

        // Final initialization logging
        console.log('[obfuscate-os-v3] ✨ Streamlined homepage loaded successfully');
        console.log(`[obfuscate-os-v3] 📊 ${modules.length} modules initialized`);
        console.log('[obfuscate-os-v3] ⚡ Animation controller:', window.animationController ? 'loaded' : 'loading...');
        console.log('[obfuscate-os-v3] 🎮 Keyboard shortcuts:');
        console.log('  • Ctrl+K: First module');
        console.log('  • Esc: Scroll to top');
        console.log('  • 1-9: Direct module access');
        console.log('  • Alt+D: Debug mode');
        console.log('  • Alt+P: Performance toggle');
        console.log('  • Alt+R: Test ripple effect');
        console.log('  • Arrow keys: Navigate modules');
        console.log('  • Konami code: Rainbow surprise 🌈');
        console.log('[obfuscate-os-v3] 🔧 Debug: ObfuscateOS object available in console');
        
        document.body.classList.add('obfuscate-os-v3-enhanced');
        
        window.dispatchEvent(new CustomEvent('obfuscate-os-loaded', {
          detail: { 
            version: '3.0', 
            modules: modules.length,
            performanceMode: window.animationController?.performanceMode || 'high',
            features: [
              'streamlined-integration',
              'external-animation-controller',
              'performance-monitoring',
              'accessibility-enhanced',
              'advanced-interactions',
              'keyboard-shortcuts',
              'context-menus',
              'error-handling',
              'state-persistence'
            ]
          }
        }));
      };

      // Start the initialization process
      waitForAnimationController();
    });
  </script>
</body>
</html>